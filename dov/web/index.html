<html>
	<head>
		<title>DOV Console</title>
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
		<script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.5/jquery-ui.min.js"></script>
		<link href="http://yui.yahooapis.com/2.8.0r4/build/reset/reset-min.css" type="text/css" rel="Stylesheet" /> 
		<link href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.5/themes/base/jquery-ui.css" type="text/css" rel="Stylesheet" />
		
		<script src="http://cdn.socket.io/stable/socket.io.js"></script>
		
		<script type="text/javascript">
			var displayError = function() {
				$('#results').append("<li>>>> Unknown Command - type 'help' to see a list of commands and their descriptions</li>");	
			}
			
			var usageError = function() {
				$('#results').append("<li>>>> Invalid Usage - type 'help' to see a list of commands and their descriptions</li>");
			}
			
			var displayText = function(text) {
				$('#results').append("<li>>>> " + text);
			}
		
			var displayHelp = function() {
				displayText("Available Commands: ");
				displayText("login [username] [password] :: Logs in a user");
				displayText("logout :: Logs out the currently logged in user");
				displayText("create_account [name] [username] [password] [email] :: Registers a new account");
			}
			
			var clear = function() {
				$("#results li").remove();
			}
			var queryServer = function(requestURL, jsonRequest, callback) {
				$.ajax({
					url: requestURL,
					method: 'GET',
					data: jsonRequest,
					dataType: 'json',
					success: function(data, status, request) {
						if(data.status==="error") {
							displayText(data.message);
						} else if (data.status==="success") {
							callback(data);
						}
					},
					failure: function(data) {
						// Show some kind of login failure here...
						displayText("ERROR: Transport level failure!");
					}
				}); // end ajax
			}
		
			$(document).ready(function(){
				$('#btnSubmit').bind('click', function() {
					// yay for super basic parsing!
					var command = $('#command')[0].value;
					var commandList = command.split(' ');
					
					if(!window.localStorage.sessionID) {
						if(commandList[0]!=="help" && commandList[0]!=="login" && commandList[0]!=="clear") {
							displayText("You must be logged in before you can issue most commands. See 'help' for more information");
							$("#command")[0].value = "";
							return;
						}
					}
					
					switch(commandList[0]) {
						case "clear":
							clear();
							break;
						case "help":
							displayHelp();
							break;
						case "session":
							if(window.localStorage.sessionID) {
								displayText("SessionID: " + window.localStorage.sessionID);
							} else {
								displayText("You are not logged in.");
							}
							break;
						case "login":
							if(commandList.length !==3) {
								usageError();
							} else {
								var jsonRequest = {
									'username': commandList[1],
									'password': commandList[2]
								}
								queryServer('/login', jsonRequest, function(data) { 
									displayText("You have logged in.");
									window.localStorage.sessionID = data.sessionID;
								});
							} // end else
							break;
						case "logout":
							if(commandList.length!==1) {
								usageError();
							} else {
								delete window.localStorage.sessionID;
								displayText("Log out requested... but not implemented");
							}
							break;
						case "create_account":
							if(commandList.length!=5) {
								usageError();
							} else {
								displayText("Create account requested... but not implemented");
							}
							break;
						default:
							displayError();
							break;
					};
					
					$("#command")[0].value = "";
				}); // end submit-click
			}); // end document-ready
		</script>
		
		
	</head>
	<body>
	<div id="container" style="width:90%; height: 90%; margin-left: auto; margin-right: auto;">
		<div id="border" class="ui-widget-content ui-corner-all" style="width:100%; height: 600px; overflow: auto;">
		<ul id="results">
			<li>>>> Type 'help' to get help... *duh*</li>
		</ul>
		</div>
		<div>
			<input type="text" id="command" class="text ui-widget-content ui-corner-all" style="width: 90%; height: 25px;"></input>
			<button id="btnSubmit" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only" role="button" aria-disabled="false">
				<span class="ui-button-text">Submit</span>
			</button>
		</div>
	</div>
	</body>
</html>